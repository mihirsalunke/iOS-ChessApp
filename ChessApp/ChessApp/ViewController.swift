//
//  ViewController.swift
//  ChessApp
//
//  Created by Mihir Salunke on 5/25/20.
//  Copyright Â© 2020 Mihir Salunke. All rights reserved.
//

import UIKit

class ViewController: UIViewController, ChessDelegate {
    
    var chessEngine = ChessEngine()
    
    var gameMode: String!
    var gameID: String! = "1"
    var isAgainstAI: Bool!
    var isWhiteTurn = true
    var userColor: String!
    var AIColor: String!
    
    let gameURL = "https://chess-api-chess.herokuapp.com/api/v1"

    @IBOutlet weak var boardView: BoardView!
    
    @IBOutlet weak var lblDisplayStatus: UILabel!
    
    @IBOutlet weak var lblDisplayTurn: UILabel!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view.
        chessEngine.initializeGame()
        boardView.pieces = chessEngine.pieces
        boardView.setNeedsDisplay()
        boardView.chessDelegate = self
        
        if self.isAgainstAI {
            promptForColorSelection(viewController: self)
        }
        
        boardView.pieces = chessEngine.pieces
        boardView.setNeedsDisplay()
        self.updateTurnOnScreen()
    }
    
    func setGameMode(gameMode: String) {
        self.gameMode = gameMode
    }
    
    func getGameMode() -> String {
        return self.gameMode
    }
    
    func setGameID(gameID: String) {
        self.gameID = gameID
    }
    
    func getGameID() -> String {
        return self.gameID
    }
    
    func promptForColorSelection(viewController: ViewController) {
        let box = UIAlertController(title: "Start Game", message: "Choose color", preferredStyle: .alert)

        box.addAction(UIAlertAction(title: "White", style: .default, handler: {
            action in
            //set color
            self.userColor = "white"
            self.AIColor = "black"
            self.isWhiteTurn = true
            print("Player is: \(action.title!)")
            print("----------------------------------------------")
            self.updateTurnOnScreen()
        }))

        box.addAction(UIAlertAction(title: "Black", style: .default, handler: {
            action in
            //set color
            self.userColor = "black"
            self.AIColor = "white"
            self.isWhiteTurn = true
            print("Player is: \(action.title!)")
            print("----------------------------------------------")
            self.updateTurnOnScreen()
        }))
            
        viewController.present(box, animated: true, completion: nil)
    }

    func movePiece(fromCol: Int, fromRow: Int, toCol: Int, toRow: Int) {
        //check if the move is valid
        if chessEngine.isMoveValid(fromCol: fromCol, fromRow: fromRow, toCol: toCol, toRow: toRow) {
            //then actually move piece
            chessEngine.movePiece(piece: chessEngine.pieceAt(col: fromCol, row: fromRow)!, toCol: toCol, toRow: toRow)
        }
        boardView.pieces = chessEngine.pieces
        boardView.setNeedsDisplay()
        self.updateTurnOnScreen()
    }
    
    func nextTurn() {
        isWhiteTurn = !isWhiteTurn
        updateTurnOnScreen()
    }
    
    func updateTurnOnScreen() {
        lblDisplayTurn.text = isWhiteTurn ? "White's turn" : "Black's turn"
        lblDisplayTurn.textColor = isWhiteTurn ? #colorLiteral(red: 0.979090035, green: 0.963788569, blue: 1, alpha: 1) : #colorLiteral(red: 0.1298420429, green: 0.1298461258, blue: 0.1298439503, alpha: 1)
    }
    
    func mapMoves(row: Int, col: Int) -> String {
        var move: String = ""
        switch col {
        case 0:
            move.append("a")
        case 1:
            move.append("b")
        case 2:
            move.append("c")
        case 3:
            move.append("d")
        case 4:
            move.append("e")
        case 5:
            move.append("f")
        case 6:
            move.append("g")
        case 7:
            move.append("h")
        default:
            move.append("NA")
        }
        
        switch row {
        case 0:
            move.append("8")
        case 1:
            move.append("7")
        case 2:
            move.append("6")
        case 3:
            move.append("5")
        case 4:
            move.append("4")
        case 5:
            move.append("3")
        case 6:
            move.append("2")
        case 7:
            move.append("1")
        default:
            move.append("NA")
        }
        
        return move
    }
    
    func reverseMapMoves(move: String) -> Array<Int> {
        var colRowMove = Array<Int>()
        let moveArray = Array(move)
        switch moveArray[0] {
        case "a":
            colRowMove.append(0)
        case "b":
            colRowMove.append(1)
        case "c":
            colRowMove.append(2)
        case "d":
            colRowMove.append(3)
        case "e":
            colRowMove.append(4)
        case "f":
            colRowMove.append(5)
        case "g":
            colRowMove.append(6)
        case "h":
            colRowMove.append(7)
        default:
            colRowMove.append(-1)
        }
        
        switch moveArray[1] {
        case "8":
            colRowMove.append(0)
        case "7":
            colRowMove.append(1)
        case "6":
            colRowMove.append(2)
        case "5":
            colRowMove.append(3)
        case "4":
            colRowMove.append(4)
        case "3":
            colRowMove.append(5)
        case "2":
            colRowMove.append(6)
        case "1":
            colRowMove.append(7)
        default:
            colRowMove.append(-1)
        }
        
        return colRowMove
    }

}

